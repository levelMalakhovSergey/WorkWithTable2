{"ast":null,"code":"import React from 'react';\nimport { actions, functionalUpdate, useMountedLayoutEffect, useGetLatest } from '../publicUtils';\n\nconst defaultInitialRowStateAccessor = row => ({});\n\nconst defaultInitialCellStateAccessor = cell => ({}); // Actions\n\n\nactions.setRowState = 'setRowState';\nactions.setCellState = 'setCellState';\nactions.resetRowState = 'resetRowState';\nexport const useRowState = hooks => {\n  hooks.stateReducers.push(reducer);\n  hooks.useInstance.push(useInstance);\n  hooks.prepareRow.push(prepareRow);\n};\nuseRowState.pluginName = 'useRowState';\n\nfunction reducer(state, action, previousState, instance) {\n  const {\n    initialRowStateAccessor = defaultInitialRowStateAccessor,\n    initialCellStateAccessor = defaultInitialCellStateAccessor,\n    rowsById\n  } = instance;\n\n  if (action.type === actions.init) {\n    return {\n      rowState: {},\n      ...state\n    };\n  }\n\n  if (action.type === actions.resetRowState) {\n    return { ...state,\n      rowState: instance.initialState.rowState || {}\n    };\n  }\n\n  if (action.type === actions.setRowState) {\n    const {\n      rowId,\n      value\n    } = action;\n    const oldRowState = typeof state.rowState[rowId] !== 'undefined' ? state.rowState[rowId] : initialRowStateAccessor(rowsById[rowId]);\n    return { ...state,\n      rowState: { ...state.rowState,\n        [rowId]: functionalUpdate(value, oldRowState)\n      }\n    };\n  }\n\n  if (action.type === actions.setCellState) {\n    const {\n      rowId,\n      columnId,\n      value\n    } = action;\n    const oldRowState = typeof state.rowState[rowId] !== 'undefined' ? state.rowState[rowId] : initialRowStateAccessor(rowsById[rowId]);\n    const oldCellState = typeof oldRowState?.cellState?.[columnId] !== 'undefined' ? oldRowState.cellState[columnId] : initialCellStateAccessor(rowsById[rowId]?.cells?.find(cell => cell.column.id === columnId));\n    return { ...state,\n      rowState: { ...state.rowState,\n        [rowId]: { ...oldRowState,\n          cellState: { ...(oldRowState.cellState || {}),\n            [columnId]: functionalUpdate(value, oldCellState)\n          }\n        }\n      }\n    };\n  }\n}\n\nfunction useInstance(instance) {\n  const {\n    autoResetRowState = true,\n    data,\n    dispatch\n  } = instance;\n  const setRowState = React.useCallback((rowId, value) => dispatch({\n    type: actions.setRowState,\n    rowId,\n    value\n  }), [dispatch]);\n  const setCellState = React.useCallback((rowId, columnId, value) => dispatch({\n    type: actions.setCellState,\n    rowId,\n    columnId,\n    value\n  }), [dispatch]);\n  const getAutoResetRowState = useGetLatest(autoResetRowState);\n  useMountedLayoutEffect(() => {\n    if (getAutoResetRowState()) {\n      dispatch({\n        type: actions.resetRowState\n      });\n    }\n  }, [data]);\n  Object.assign(instance, {\n    setRowState,\n    setCellState\n  });\n}\n\nfunction prepareRow(row, _ref) {\n  let {\n    instance\n  } = _ref;\n  const {\n    initialRowStateAccessor = defaultInitialRowStateAccessor,\n    initialCellStateAccessor = defaultInitialCellStateAccessor,\n    state: {\n      rowState\n    }\n  } = instance;\n\n  if (row) {\n    row.state = typeof rowState[row.id] !== 'undefined' ? rowState[row.id] : initialRowStateAccessor(row);\n\n    row.setState = updater => {\n      return instance.setRowState(row.id, updater);\n    };\n\n    row.cells.forEach(cell => {\n      if (!row.state.cellState) {\n        row.state.cellState = {};\n      }\n\n      cell.state = typeof row.state.cellState[cell.column.id] !== 'undefined' ? row.state.cellState[cell.column.id] : initialCellStateAccessor(cell);\n\n      cell.setState = updater => {\n        return instance.setCellState(row.id, cell.column.id, updater);\n      };\n    });\n  }\n}","map":{"version":3,"sources":["C:/Projects/TableSite/tablesite2/node_modules/react-table/src/plugin-hooks/useRowState.js"],"names":["React","actions","functionalUpdate","useMountedLayoutEffect","useGetLatest","defaultInitialRowStateAccessor","row","defaultInitialCellStateAccessor","cell","setRowState","setCellState","resetRowState","useRowState","hooks","stateReducers","push","reducer","useInstance","prepareRow","pluginName","state","action","previousState","instance","initialRowStateAccessor","initialCellStateAccessor","rowsById","type","init","rowState","initialState","rowId","value","oldRowState","columnId","oldCellState","cellState","cells","find","column","id","autoResetRowState","data","dispatch","useCallback","getAutoResetRowState","Object","assign","setState","updater","forEach"],"mappings":"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","sourcesContent":["import React from 'react'\n\nimport {\n  actions,\n  functionalUpdate,\n  useMountedLayoutEffect,\n  useGetLatest,\n} from '../publicUtils'\n\nconst defaultInitialRowStateAccessor = row => ({})\nconst defaultInitialCellStateAccessor = cell => ({})\n\n// Actions\nactions.setRowState = 'setRowState'\nactions.setCellState = 'setCellState'\nactions.resetRowState = 'resetRowState'\n\nexport const useRowState = hooks => {\n  hooks.stateReducers.push(reducer)\n  hooks.useInstance.push(useInstance)\n  hooks.prepareRow.push(prepareRow)\n}\n\nuseRowState.pluginName = 'useRowState'\n\nfunction reducer(state, action, previousState, instance) {\n  const {\n    initialRowStateAccessor = defaultInitialRowStateAccessor,\n    initialCellStateAccessor = defaultInitialCellStateAccessor,\n    rowsById,\n  } = instance\n\n  if (action.type === actions.init) {\n    return {\n      rowState: {},\n      ...state,\n    }\n  }\n\n  if (action.type === actions.resetRowState) {\n    return {\n      ...state,\n      rowState: instance.initialState.rowState || {},\n    }\n  }\n\n  if (action.type === actions.setRowState) {\n    const { rowId, value } = action\n\n    const oldRowState =\n      typeof state.rowState[rowId] !== 'undefined'\n        ? state.rowState[rowId]\n        : initialRowStateAccessor(rowsById[rowId])\n\n    return {\n      ...state,\n      rowState: {\n        ...state.rowState,\n        [rowId]: functionalUpdate(value, oldRowState),\n      },\n    }\n  }\n\n  if (action.type === actions.setCellState) {\n    const { rowId, columnId, value } = action\n\n    const oldRowState =\n      typeof state.rowState[rowId] !== 'undefined'\n        ? state.rowState[rowId]\n        : initialRowStateAccessor(rowsById[rowId])\n\n    const oldCellState =\n      typeof oldRowState?.cellState?.[columnId] !== 'undefined'\n        ? oldRowState.cellState[columnId]\n        : initialCellStateAccessor(\n            rowsById[rowId]?.cells?.find(cell => cell.column.id === columnId)\n          )\n\n    return {\n      ...state,\n      rowState: {\n        ...state.rowState,\n        [rowId]: {\n          ...oldRowState,\n          cellState: {\n            ...(oldRowState.cellState || {}),\n            [columnId]: functionalUpdate(value, oldCellState),\n          },\n        },\n      },\n    }\n  }\n}\n\nfunction useInstance(instance) {\n  const { autoResetRowState = true, data, dispatch } = instance\n\n  const setRowState = React.useCallback(\n    (rowId, value) =>\n      dispatch({\n        type: actions.setRowState,\n        rowId,\n        value,\n      }),\n    [dispatch]\n  )\n\n  const setCellState = React.useCallback(\n    (rowId, columnId, value) =>\n      dispatch({\n        type: actions.setCellState,\n        rowId,\n        columnId,\n        value,\n      }),\n    [dispatch]\n  )\n\n  const getAutoResetRowState = useGetLatest(autoResetRowState)\n\n  useMountedLayoutEffect(() => {\n    if (getAutoResetRowState()) {\n      dispatch({ type: actions.resetRowState })\n    }\n  }, [data])\n\n  Object.assign(instance, {\n    setRowState,\n    setCellState,\n  })\n}\n\nfunction prepareRow(row, { instance }) {\n  const {\n    initialRowStateAccessor = defaultInitialRowStateAccessor,\n    initialCellStateAccessor = defaultInitialCellStateAccessor,\n    state: { rowState },\n  } = instance\n\n  if (row) {\n    row.state =\n      typeof rowState[row.id] !== 'undefined'\n        ? rowState[row.id]\n        : initialRowStateAccessor(row)\n\n    row.setState = updater => {\n      return instance.setRowState(row.id, updater)\n    }\n\n    row.cells.forEach(cell => {\n      if (!row.state.cellState) {\n        row.state.cellState = {}\n      }\n\n      cell.state =\n        typeof row.state.cellState[cell.column.id] !== 'undefined'\n          ? row.state.cellState[cell.column.id]\n          : initialCellStateAccessor(cell)\n\n      cell.setState = updater => {\n        return instance.setCellState(row.id, cell.column.id, updater)\n      }\n    })\n  }\n}\n"]},"metadata":{},"sourceType":"module"}